<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotspot Analysis</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-heatmap@0.1.0/dist/leaflet-heatmap.css" />

  <style>
    /* Custom styling for the map */
        #map {
        height: 700px;
        width: 100%;
        }
        body {
            display: flex;
            margin: 0;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        #sidebar {
            width: 250px;
            background: #f8f9fa;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto; /* Allows scrolling */
        }
        #sidebar h2 {
            margin-top: 0;
            font-size: 1.5em;
        }
        #sidebar ul {
            list-style: none;
            padding: 0;
        }
        #sidebar ul li {
            padding: 10px;
            cursor: pointer;
        }
        #sidebar ul li:hover {
            background: #e2e6ea;
        }
        .footer {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 0.9em;
        }
  </style>
</head>
<body>

    <div id="sidebar">
        <h2>Crime Analysis</h2>
        <ul>
            <li><a href="index.html">Crime Hotspot Analysis</a></li>
            <li>Predictive Crime Analysis</li>
            <li><a href="incidance.html"> Incident Mapping </a></li>
            <li><a href="realtime.html">Real-time Alerts</a></li>
            <li><a href="policeForm.html">Register New Crime</a></li>
            <li>Criminal Behavior Patterns</li>
        </ul>
        <h2>Settings</h2>
        <ul>
            <li>Profile</li>
            <li>Settings</li>
            <li>Help</li>
            <li>About</li>
        </ul>
    </div>  


  <div class="container mt-4">
    <h1 class="text-center">Crime Hotspot Analysis</h1>
    
    <!-- Row for map and information panel -->
    <div class="row">
      <div class="col-md-12">
        <!-- Leaflet Map -->
        <div id="map"></div>
      </div>
   
    </div>
  </div>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <!-- Leaflet Heatmap Plugin -->
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <script>
    // Initialize the map and set its view
    var map = L.map('map').setView([19.0760, 72.8777], 12);  // Centered on Mumbai

   
    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    

    // Function to style the GeoJSON layers
    function style1(feature) {
        return {
            color: "#ff7800",
            weight: 1,
            opacity: 0.65
        };
    }

    function style2(feature) {
        return {
            color: "#0057e7",
            weight: 1,
            opacity: 0.65
        };
    }

    function style3(feature) {
        return {
            color: "#005666",
            weight: 1,
            opacity: 0.65
        };
    }
        // Function to bind popup information for each feature
    function onEachFeature1(feature, layer) {
        if (feature.properties && feature.properties.Name) {
            layer.bindPopup("<strong> Station :</strong> " + feature.properties.Name);
        } else {
            console.warn('Feature properties not found for layer 1:', feature);
        }
    }

    function onEachFeature2(feature, layer) {
        if (feature.properties && feature.properties.Name) {
            layer.bindPopup("<strong> Juridiction :</strong> " + feature.properties.Name);
        } else {
            console.warn('Feature properties not found for layer 2:', feature);
        }
    }


    function onEachFeature3(feature, layer) {
        if (feature.properties && feature.properties.name) {
            layer.bindPopup("<strong> Crime :</strong> " + feature.properties.name);
        } else {
            console.warn('Feature properties not found for layer 3:', feature);
        }
    }

        // Define GeoJSON layers
        var geojsonLayer1 = L.geoJSON(null, {
            style: style1,
            onEachFeature: onEachFeature1
        });

        var geojsonLayer2 = L.geoJSON(null, {
            style: style2,
            onEachFeature: onEachFeature2
        });

        var geojsonLayer3 = L.geoJSON(null, {
            style: style3,
            onEachFeature: onEachFeature3
        });

    // Load GeoJSON files and add data to layers
    fetch('Point_Police_Station.geojson')
            .then(response => response.json())
            .then(data => {
                geojsonLayer1.addData(data);
            })
            .catch(error => console.error('Error loading GeoJSON 1:', error));

    fetch('Police_Station_Jurdition.geojson')
            .then(response => response.json())
            .then(data => {
                geojsonLayer2.addData(data);
            })
            .catch(error => console.error('Error loading GeoJSON 2:', error));

    fetch('Point_Crime_Synthetic.geojson')
            .then(response => response.json())
            .then(data => {
                geojsonLayer3.addData(data);
            })
            .catch(error => console.error('Error loading GeoJSON 3:', error));        

     

    // Function to create circle markers for GeoJSON points
    function pointToCircle(feature, latlng) {
        return L.circle(latlng, {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 300 // Adjust the radius as needed
        }).bindPopup(feature.properties.description); // Bind popup with description
    }

    // Fetch the GeoJSON data for crime incidents
    fetch('Point_Crime_Synthetic.geojson')
        .then(response => response.json())
        .then(data => {
            // Add the data to geojsonLayer3 and create circle markers
            geojsonLayer3 = L.geoJSON(data, {
                pointToLayer: pointToCircle // Use the pointToCircle function for point features
            });

            // Add geojsonLayer3 to the map
            geojsonLayer3.addTo(map);
        })
        .catch(error => console.error('Error loading GeoJSON 3:', error));


    // Add base layers to the layer control
    var baseMaps = {
        "Police Stations": geojsonLayer1,
        "Station Jurisdiction": geojsonLayer2,
        "Crime": geojsonLayer3 // Initially, this layer will be empty until data is loaded
    };

    // Layer control to toggle layers
    L.control.layers(null, baseMaps).addTo(map);

</script>

</body>
</html>